"use strict";(globalThis["webpackChunkquasar_dev"]=globalThis["webpackChunkquasar_dev"]||[]).push([[99234],{99234:(n,e,s)=>{s.r(e),s.d(e,{default:()=>A});var o=s(83673);const t=(0,o._)("p",null,[(0,o.Uk)("For security reasons, the renderer thread (your UI code from "),(0,o._)("code",{class:"doc-token"},"/src"),(0,o.Uk)(") does not have access to the Node.js stuff. However, you can run Node.js code and bridge it to the renderer thread through an Electron Preload script located at "),(0,o._)("code",{class:"doc-token"},"/src-electron/electron-preload.[js|ts]"),(0,o.Uk)(". Use "),(0,o._)("code",{class:"doc-token"},"contextBridge"),(0,o.Uk)(" (from the "),(0,o._)("code",{class:"doc-token"},"electron"),(0,o.Uk)(" package) to expose the stuff that you need for your UI.")],-1),a=(0,o._)("p",null,"Since the preload script runs from Node.js, be careful what you do with it and what you expose to the renderer thread!",-1),c=(0,o._)("p",null,[(0,o.Uk)("In "),(0,o._)("code",{class:"doc-token"},"/src-electron/"),(0,o.Uk)(" folder, there is a file named "),(0,o._)("code",{class:"doc-token"},"electron-preload.js"),(0,o.Uk)(". Fill it with your preload code.")],-1),l=(0,o._)("p",null,[(0,o.Uk)("Make sure that your "),(0,o._)("code",{class:"doc-token"},"/src-electron/electron-main.[js|ts]"),(0,o.Uk)(" has the following (near the “webPreferences” section):")],-1),p=(0,o._)("pre",{class:"doc-code language-js"},[(0,o._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,o._)("span",{class:"token comment"},"// file: /src-electron/electron-main.[js|ts]"),(0,o.Uk)("\n\n"),(0,o._)("span",{class:"token comment"},"// Add this at the top:"),(0,o.Uk)("\n"),(0,o._)("span",{class:"token keyword"},"import"),(0,o.Uk)(" path "),(0,o._)("span",{class:"token keyword"},"from"),(0,o.Uk)(),(0,o._)("span",{class:"token string"},"'path'"),(0,o.Uk)("\n\n"),(0,o._)("span",{class:"token comment"},"// ..."),(0,o.Uk)("\n\n"),(0,o._)("span",{class:"token keyword"},"function"),(0,o.Uk)(),(0,o._)("span",{class:"token function"},"createWindow"),(0,o.Uk)(),(0,o._)("span",{class:"token punctuation"},"("),(0,o._)("span",{class:"token punctuation"},")"),(0,o.Uk)(),(0,o._)("span",{class:"token punctuation"},"{"),(0,o.Uk)("\n  "),(0,o._)("span",{class:"token comment"},"// ..."),(0,o.Uk)("\n  mainWindow "),(0,o._)("span",{class:"token operator"},"="),(0,o.Uk)(),(0,o._)("span",{class:"token keyword"},"new"),(0,o.Uk)(),(0,o._)("span",{class:"token class-name"},"BrowserWindow"),(0,o._)("span",{class:"token punctuation"},"("),(0,o._)("span",{class:"token punctuation"},"{"),(0,o.Uk)("\n    "),(0,o._)("span",{class:"token comment"},"// ..."),(0,o.Uk)("\n    "),(0,o._)("span",{class:"token literal-property property"},"webPreferences"),(0,o._)("span",{class:"token operator"},":"),(0,o.Uk)(),(0,o._)("span",{class:"token punctuation"},"{"),(0,o.Uk)("\n      "),(0,o._)("span",{class:"token comment"},"// HERE IS THE MAGIC:"),(0,o.Uk)("\n      "),(0,o._)("span",{class:"token literal-property property"},"preload"),(0,o._)("span",{class:"token operator"},":"),(0,o.Uk)(" path"),(0,o._)("span",{class:"token punctuation"},"."),(0,o._)("span",{class:"token function"},"resolve"),(0,o._)("span",{class:"token punctuation"},"("),(0,o.Uk)("__dirname"),(0,o._)("span",{class:"token punctuation"},","),(0,o.Uk)(" process"),(0,o._)("span",{class:"token punctuation"},"."),(0,o.Uk)("env"),(0,o._)("span",{class:"token punctuation"},"."),(0,o._)("span",{class:"token constant"},"QUASAR_ELECTRON_PRELOAD"),(0,o._)("span",{class:"token punctuation"},")"),(0,o.Uk)("\n    "),(0,o._)("span",{class:"token punctuation"},"}"),(0,o.Uk)("\n  "),(0,o._)("span",{class:"token punctuation"},"}"),(0,o._)("span",{class:"token punctuation"},")"),(0,o.Uk)("\n")])],-1),r=(0,o._)("p",null,[(0,o.Uk)("Example of "),(0,o._)("code",{class:"doc-token"},"/src-electron/electron-preload.[js|ts]"),(0,o.Uk)(" content:")],-1),i=(0,o._)("pre",{class:"doc-code language-js"},[(0,o._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,o._)("span",{class:"token comment"},"// example which injects window.myAPI.doAThing() into the renderer"),(0,o.Uk)("\n"),(0,o._)("span",{class:"token comment"},"// thread (/src/*)"),(0,o.Uk)("\n\n"),(0,o._)("span",{class:"token keyword"},"const"),(0,o.Uk)(),(0,o._)("span",{class:"token punctuation"},"{"),(0,o.Uk)(" contextBridge "),(0,o._)("span",{class:"token punctuation"},"}"),(0,o.Uk)(),(0,o._)("span",{class:"token operator"},"="),(0,o.Uk)(),(0,o._)("span",{class:"token function"},"require"),(0,o._)("span",{class:"token punctuation"},"("),(0,o._)("span",{class:"token string"},"'electron'"),(0,o._)("span",{class:"token punctuation"},")"),(0,o.Uk)("\n\ncontextBridge"),(0,o._)("span",{class:"token punctuation"},"."),(0,o._)("span",{class:"token function"},"exposeInMainWorld"),(0,o._)("span",{class:"token punctuation"},"("),(0,o._)("span",{class:"token string"},"'myAPI'"),(0,o._)("span",{class:"token punctuation"},","),(0,o.Uk)(),(0,o._)("span",{class:"token punctuation"},"{"),(0,o.Uk)("\n  "),(0,o._)("span",{class:"token function-variable function"},"doAThing"),(0,o._)("span",{class:"token operator"},":"),(0,o.Uk)(),(0,o._)("span",{class:"token punctuation"},"("),(0,o._)("span",{class:"token punctuation"},")"),(0,o.Uk)(),(0,o._)("span",{class:"token operator"},"=>"),(0,o.Uk)(),(0,o._)("span",{class:"token punctuation"},"{"),(0,o._)("span",{class:"token punctuation"},"}"),(0,o.Uk)("\n"),(0,o._)("span",{class:"token punctuation"},"}"),(0,o._)("span",{class:"token punctuation"},")"),(0,o.Uk)("\n")])],-1),k=(0,o._)("div",{class:"doc-note doc-note--warning"},[(0,o._)("p",{class:"doc-note__title"},"WARNING"),(0,o._)("ol",null,[(0,o._)("li",null,"Be aware that this file runs in a Node.js context."),(0,o._)("li",null,"If you import anything from node_modules, then make sure that the package is specified in /package.json > “dependencies” and NOT in “devDependencies”.")])],-1),d=(0,o._)("p",null,[(0,o.Uk)("Just by using "),(0,o._)("code",{class:"doc-token"},"contextBridge"),(0,o.Uk)(" does not automatically mean that everything you do is safe. For instance the code below is unsafe:")],-1),u=(0,o._)("pre",{class:"doc-code language-js"},[(0,o._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,o._)("span",{class:"token comment"},"// BAD code; DON'T!!"),(0,o.Uk)("\ncontextBridge"),(0,o._)("span",{class:"token punctuation"},"."),(0,o._)("span",{class:"token function"},"exposeInMainWorld"),(0,o._)("span",{class:"token punctuation"},"("),(0,o._)("span",{class:"token string"},"'myAPI'"),(0,o._)("span",{class:"token punctuation"},","),(0,o.Uk)(),(0,o._)("span",{class:"token punctuation"},"{"),(0,o.Uk)("\n  "),(0,o._)("span",{class:"token literal-property property"},"send"),(0,o._)("span",{class:"token operator"},":"),(0,o.Uk)(" ipcRenderer"),(0,o._)("span",{class:"token punctuation"},"."),(0,o.Uk)("send\n"),(0,o._)("span",{class:"token punctuation"},"}"),(0,o._)("span",{class:"token punctuation"},")"),(0,o.Uk)("\n")])],-1),_=(0,o._)("p",null,"It directly exposes a powerful API without any kind of argument filtering. This would allow any website to send arbitrary IPC messages which you do not want to be possible. The correct way to expose IPC-based APIs would instead be to provide one method per IPC message.",-1),U=(0,o._)("pre",{class:"doc-code language-js"},[(0,o._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,o._)("span",{class:"token comment"},"// Good code"),(0,o.Uk)("\ncontextBridge"),(0,o._)("span",{class:"token punctuation"},"."),(0,o._)("span",{class:"token function"},"exposeInMainWorld"),(0,o._)("span",{class:"token punctuation"},"("),(0,o._)("span",{class:"token string"},"'myAPI'"),(0,o._)("span",{class:"token punctuation"},","),(0,o.Uk)(),(0,o._)("span",{class:"token punctuation"},"{"),(0,o.Uk)("\n  "),(0,o._)("span",{class:"token function-variable function"},"loadPreferences"),(0,o._)("span",{class:"token operator"},":"),(0,o.Uk)(),(0,o._)("span",{class:"token punctuation"},"("),(0,o._)("span",{class:"token punctuation"},")"),(0,o.Uk)(),(0,o._)("span",{class:"token operator"},"=>"),(0,o.Uk)(" ipcRenderer"),(0,o._)("span",{class:"token punctuation"},"."),(0,o._)("span",{class:"token function"},"invoke"),(0,o._)("span",{class:"token punctuation"},"("),(0,o._)("span",{class:"token string"},"'load-prefs'"),(0,o._)("span",{class:"token punctuation"},")"),(0,o.Uk)("\n"),(0,o._)("span",{class:"token punctuation"},"}"),(0,o._)("span",{class:"token punctuation"},")"),(0,o.Uk)("\n")])],-1),h=(0,o._)("p",null,[(0,o.Uk)("Now, "),(0,o._)("code",{class:"doc-token"},"loadPreferences"),(0,o.Uk)(" is available globally in your javascript code (ie: "),(0,o._)("code",{class:"doc-token"},"window.myAPI.loadPreferences"),(0,o.Uk)(").")],-1),g=(0,o._)("div",{class:"doc-note doc-note--warning"},[(0,o._)("p",{class:"doc-note__title"},"WARNING"),(0,o._)("p",null,[(0,o.Uk)("Make sure to pick names which do not colide with existing "),(0,o._)("code",{class:"doc-token"},"Window"),(0,o.Uk)(" keys.")])],-1),m=(0,o._)("p",null,[(0,o.Uk)("Using the above code with an "),(0,o._)("code",{class:"doc-token"},"invoke"),(0,o.Uk)(" to "),(0,o._)("code",{class:"doc-token"},"load-prefs"),(0,o.Uk)(" in the main thread would have code like this:")],-1),y=(0,o._)("pre",{class:"doc-code language-js"},[(0,o._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,o.Uk)("ipcMain"),(0,o._)("span",{class:"token punctuation"},"."),(0,o._)("span",{class:"token function"},"handle"),(0,o._)("span",{class:"token punctuation"},"("),(0,o._)("span",{class:"token string"},"'myAPI:load-prefs'"),(0,o._)("span",{class:"token punctuation"},","),(0,o.Uk)(),(0,o._)("span",{class:"token punctuation"},"("),(0,o._)("span",{class:"token punctuation"},")"),(0,o.Uk)(),(0,o._)("span",{class:"token operator"},"=>"),(0,o.Uk)(),(0,o._)("span",{class:"token punctuation"},"{"),(0,o.Uk)("\n  "),(0,o._)("span",{class:"token keyword"},"return"),(0,o.Uk)(),(0,o._)("span",{class:"token punctuation"},"{"),(0,o.Uk)("\n    "),(0,o._)("span",{class:"token comment"},"// object that contains preferences"),(0,o.Uk)("\n  "),(0,o._)("span",{class:"token punctuation"},"}"),(0,o.Uk)("\n"),(0,o._)("span",{class:"token punctuation"},"}"),(0,o._)("span",{class:"token punctuation"},")"),(0,o.Uk)("\n")])],-1),w=(0,o._)("p",null,[(0,o.Uk)("Should you wish to change the location of the preload script (and/or even the main thread file) then edit "),(0,o._)("code",{class:"doc-token"},"/quasar.conf.js"),(0,o.Uk)(":")],-1),f=(0,o._)("pre",{class:"doc-code language-js"},[(0,o._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,o._)("span",{class:"token comment"},"// should you wish to change default files"),(0,o.Uk)("\n"),(0,o._)("span",{class:"token literal-property property"},"sourceFiles"),(0,o._)("span",{class:"token operator"},":"),(0,o.Uk)(),(0,o._)("span",{class:"token punctuation"},"{"),(0,o.Uk)("\n  "),(0,o._)("span",{class:"token literal-property property"},"electronMain"),(0,o._)("span",{class:"token operator"},":"),(0,o.Uk)(),(0,o._)("span",{class:"token string"},"'src-electron/electron-main.js'"),(0,o._)("span",{class:"token punctuation"},","),(0,o.Uk)("\n  "),(0,o._)("span",{class:"token literal-property property"},"electronPreload"),(0,o._)("span",{class:"token operator"},":"),(0,o.Uk)(),(0,o._)("span",{class:"token string"},"'src-electron/electron-preload.js'"),(0,o.Uk)("\n"),(0,o._)("span",{class:"token punctuation"},"}"),(0,o.Uk)("\n")])],-1);function j(n,e,s,j,I,v){const P=(0,o.up)("doc-page");return(0,o.wg)(),(0,o.j4)(P,{"meta-title":j.metaTitle,title:"Electron Preload Script","meta-desc":j.metaDesc},{default:(0,o.w5)((()=>[t,a,(0,o._)("h2",{id:"how-to-use-it",class:"doc-heading doc-h2",onClick:e[0]||(e[0]=n=>j.copyHeading("how-to-use-it"))},"How to use it"),c,l,p,r,i,k,(0,o._)("h2",{id:"security-considerations",class:"doc-heading doc-h2",onClick:e[1]||(e[1]=n=>j.copyHeading("security-considerations"))},"Security considerations"),d,u,_,U,h,g,m,y,(0,o._)("h2",{id:"custom-path-to-the-preload-script",class:"doc-heading doc-h2",onClick:e[2]||(e[2]=n=>j.copyHeading("custom-path-to-the-preload-script"))},"Custom path to the preload script"),w,f])),_:1},8,["meta-title","meta-desc"])}var I=s(17536);const v={name:"DocMarkdownPage",setup(){return{metaTitle:"Electron Preload Script",metaDesc:"How to handle Electron Node Integration with an Electron Preload script with Quasar CLI.",copyHeading:I.Et}}};var P=s(74260);const b=(0,P.Z)(v,[["render",j]]),A=b}}]);