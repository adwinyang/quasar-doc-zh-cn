"use strict";(globalThis["webpackChunkquasar_dev"]=globalThis["webpackChunkquasar_dev"]||[]).push([[51955],{51955:(n,s,a)=>{a.r(s),a.d(s,{default:()=>mn});var t=a(83673);const o=(0,t._)("p",null,"SSR中间件文件实现了一个特殊的目的：它们为运行SSR应用程序的Nodejs服务器准备了额外的功能(兼容Expressjs的中间件)。",-1),e=(0,t._)("p",null,[(0,t.Uk)("通过SSR中间件文件，可以将中间件逻辑分割成独立的、易于维护的文件。禁用任何SSR中间件文件，甚至通过"),(0,t._)("code",{class:"doc-token"},"quasar.conf.js"),(0,t.Uk)("配置来决定哪些SSR中间件文件进入构建，也是非常简单的。")],-1),c={class:"doc-note doc-note--tip"},p=(0,t._)("p",{class:"doc-note__title"},"TIP",-1),l=(0,t.Uk)("对于更高级的使用，你将需要熟悉"),k=(0,t.Uk)("Expressjs API"),u=(0,t.Uk)(" 。"),_=(0,t._)("div",{class:"doc-note doc-note--warning"},[(0,t._)("p",{class:"doc-note__title"},"WARNING"),(0,t._)("p",null,[(0,t.Uk)("你将需要至少一个SSR中间件文件来处理用Vue渲染的页面(它应该被定位在中间件列表的最后一个)。当SSR模式被添加到你的 Quasar CLI 项目中时，它将被架设到"),(0,t._)("code",{class:"doc-token"},"src-ssr/middlewares/render.js"),(0,t.Uk)("。")])],-1),r=(0,t._)("p",null,"SSR中间件文件是一个简单的JavaScript文件，它导出了一个函数。Quasar在准备Nodejs服务器(Expressjs)应用程序时将调用导出的函数，并另外传递一个Object作为参数(将在下一节中详细说明)。",-1),i=(0,t._)("pre",{class:"doc-code language-js"},[(0,t._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,t._)("span",{class:"token comment"},"// 在此输入一些东西"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"default"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" app"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" resolve"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" publicPath"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" folders"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" render"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" serve "),(0,t._)("span",{class:"token punctuation"},"}")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token comment"},'// 与服务器 "应用程序 "有关的东西'),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])],-1),d=(0,t._)("p",null,"SSR中间件文件也可以是异步的：",-1),U=(0,t._)("pre",{class:"doc-code language-js"},[(0,t._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,t._)("span",{class:"token comment"},"// 在此输入一些东西"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"default"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"async"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" app"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" resolve"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" publicPath"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" folders"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" render"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" serve "),(0,t._)("span",{class:"token punctuation"},"}")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token comment"},'// 与服务器 "应用程序 "有关的东西'),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"await"),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"something"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])],-1),m=(0,t._)("p",null,[(0,t.Uk)("你可以用"),(0,t._)("code",{class:"doc-token"},"ssrMiddleware"),(0,t.Uk)("帮助器包装返回的函数，以获得更好的IDE自动完成体验(通过Typescript)：")],-1),g=(0,t._)("pre",{class:"doc-code language-js"},[(0,t._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,t._)("span",{class:"token keyword"},"import"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" ssrMiddleware "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"from"),(0,t.Uk)(),(0,t._)("span",{class:"token string"},"'quasar/wrappers'"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"default"),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"ssrMiddleware"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token keyword"},"async"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" app"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" resolve"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" publicPath"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" folders"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" render"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" serve "),(0,t._)("span",{class:"token punctuation"},"}")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token comment"},"// 有事可做"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"await"),(0,t.Uk)(),(0,t._)("span",{class:"token function"},"something"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n")])],-1),h=(0,t.Uk)("注意我们使用的是"),y=(0,t.Uk)("ES6结构化赋值"),f=(0,t.Uk)("。只赋值你实际需要/使用的东西。"),w=(0,t._)("p",null,"我们在这里指的是由SSR中间件文件的默认导出函数作为参数接收的对象。",-1),S=(0,t._)("pre",{class:"doc-code language-js"},[(0,t._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,t._)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"default"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" app"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" resolve"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" publicPath"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" folders"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" render"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" serve "),(0,t._)("span",{class:"token punctuation"},"}")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n")])],-1),j=(0,t._)("p",null,"详细说明对象：",-1),v=(0,t._)("pre",{class:"doc-code language-js"},[(0,t._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  app"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token comment"},"// Expressjs app instance"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token literal-property property"},"resolve"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token function"},"urlPath"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("path"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token function"},"root"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("arg1"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" arg2"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token keyword"},"public"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("arg1"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" arg2"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  publicPath"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token comment"},"// String"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token literal-property property"},"folders"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    root"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("     "),(0,t._)("span",{class:"token comment"},"// String"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token keyword"},"public"),(0,t.Uk)("    "),(0,t._)("span",{class:"token comment"},"// String"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token function"},"render"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("ssrContext"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token literal-property property"},"serve"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token keyword"},"static"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("path"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" opts"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token function"},"error"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" err"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" req"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" res "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])],-1),b=(0,t._)("p",null,"这是Expressjs的应用实例。任何中间件的 “面包和黄油”，因为你将用它来配置网络服务器。",-1),R=(0,t._)("thead",null,[(0,t._)("tr",null,[(0,t._)("th",{class:"text-left"},"属性名"),(0,t._)("th",{class:"text-left"},"描述")])],-1),x=(0,t._)("tbody",null,[(0,t._)("tr",null,[(0,t._)("td",null,[(0,t._)("code",{class:"doc-token"},"urlPath(path)"),(0,t.Uk)(" 每当你定义一个路由(用app.use(), app.get(), app.post()等)，你应该使用"),(0,t._)("code",{class:"doc-token"},"resolve.urlPath()"),(0,t.Uk)("方法，这样你也会考虑到配置的publicPath(quasar.conf.js > build > publicPath)。")]),(0,t._)("td")]),(0,t._)("tr",null,[(0,t._)("td",null,[(0,t._)("code",{class:"doc-token"},"root(path1[, path2, ...pathN])")]),(0,t._)("td",null,[(0,t.Uk)("解决文件夹路径到根(开发中的项目和生产中的可分发文件)。在系统内部，它做了一个"),(0,t._)("code",{class:"doc-token"},"path.join()"),(0,t.Uk)("。")])]),(0,t._)("tr",null,[(0,t._)("td",null,[(0,t._)("code",{class:"doc-token"},"public(path1[, path2, ...pathN])")]),(0,t._)("td",null,[(0,t.Uk)('将文件夹路径解析到 "public "文件夹。在引擎中，它做了一个'),(0,t._)("code",{class:"doc-token"},"path.join()"),(0,t.Uk)("。")])])],-1),q=(0,t._)("p",null,"配置的 quasar.conf.js > build > publicPath",-1),P=(0,t._)("p",null,[(0,t.Uk)("有时需要使用"),(0,t._)("code",{class:"doc-token"},"folders"),(0,t.Uk)("，因为在生产构建中，根文件夹和公共文件夹的确切路径与开发构建中不同。所以通过使用"),(0,t._)("code",{class:"doc-token"},"folders"),(0,t.Uk)("，你就不需要在意这些了。")],-1),C=(0,t._)("thead",null,[(0,t._)("tr",null,[(0,t._)("th",{class:"text-left"},"属性名"),(0,t._)("th",{class:"text-left"},"描述")])],-1),H=(0,t._)("tbody",null,[(0,t._)("tr",null,[(0,t._)("td",null,[(0,t._)("code",{class:"doc-token"},"root")]),(0,t._)("td",null,"根部的完整路径(开发中的项目和生产中的可分发文件)。")]),(0,t._)("tr",null,[(0,t._)("td",null,[(0,t._)("code",{class:"doc-token"},"public")]),(0,t._)("td",null,'"public "文件夹的完整路径。')])],-1),E=(0,t._)("ul",null,[(0,t._)("li",null,[(0,t.Uk)("语法： "),(0,t._)("code",{class:"doc-token"},"<Promise(String)> render.vue(ssrContext)"),(0,t.Uk)(".")]),(0,t._)("li",null,"描述： 使用Vue和Vue Router来渲染请求的URL路径。返回渲染后的HTML字符串以返回给客户端。")],-1),I=(0,t._)("p",null,"service.static()。",-1),N=(0,t._)("ul",null,[(0,t._)("li",null,[(0,t._)("p",null,[(0,t.Uk)("语法："),(0,t._)("code",{class:"doc-token"},"<middlewareFn> serve.static(pathFromPublicFolder, opts)"),(0,t.Uk)("。")])]),(0,t._)("li",null,[(0,t._)("p",null,[(0,t.Uk)("描述：它本质上是对"),(0,t._)("code",{class:"doc-token"},"express.static()"),(0,t.Uk)("的一个封装，并做了一些方便的调整：")]),(0,t._)("ul",null,[(0,t._)("li",null,[(0,t._)("code",{class:"doc-token"},"pathFromPublicFolder"),(0,t.Uk)('是一个解析到 "公共 "文件夹的路径。')]),(0,t._)("li",null,[(0,t._)("code",{class:"doc-token"},"opts"),(0,t.Uk)("与"),(0,t._)("code",{class:"doc-token"},"express.static()"),(0,t.Uk)("的相同。")]),(0,t._)("li",null,[(0,t._)("code",{class:"doc-token"},"opts.maxAge"),(0,t.Uk)("是默认使用的，考虑到quasar.conf.js > ssr > maxAge配置；这设置了相关文件在浏览器缓存中的生存时间")])]),(0,t._)("pre",{class:"doc-code language-js"},[(0,t._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,t.Uk)("service"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"static"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'my-file.json'"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token comment"},"// 相当于："),(0,t.Uk)("\n\nexpress"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"static"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("resolve"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"public"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'my-file.json'"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token literal-property property"},"maxAge"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"..."),(0,t.Uk)(),(0,t._)("span",{class:"token comment"},"// quasar.conf.js > ssr > maxAge"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n")])])])],-1),T=(0,t._)("p",null,"serve.error()。",-1),L=(0,t._)("ul",null,[(0,t._)("li",null,[(0,t._)("p",null,[(0,t.Uk)("语法："),(0,t._)("code",{class:"doc-token"},"<void> render.error({ err, req, res })"),(0,t.Uk)("。")])]),(0,t._)("li",null,[(0,t._)("p",null,"描述：显示大量有用的调试信息(包括堆栈跟踪)。")]),(0,t._)("li",null,[(0,t._)("p",null,[(0,t.Uk)("它只在开发中可用，"),(0,t._)("strong",null,"不在生产中"),(0,t.Uk)("。")])])],-1),V=(0,t._)("p",null,"第一步是使用 Quasar CLI 生成一个新的SSR中间件文件。",-1),A=(0,t._)("pre",{class:"doc-code language-bash"},[(0,t._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-bash"},[(0,t.Uk)("$ quasar new ssrmiddleware "),(0,t._)("span",{class:"token operator"},"<"),(0,t.Uk)("name"),(0,t._)("span",{class:"token operator"},">"),(0,t.Uk)("\n")])],-1),Q=(0,t._)("p",null,[(0,t.Uk)("其中"),(0,t._)("code",{class:"doc-token"},"<name>"),(0,t.Uk)("应该由你的SSR中间件文件的一个合适的名字来代替。")],-1),W=(0,t._)("p",null,[(0,t.Uk)("这个命令创建了一个新文件。"),(0,t._)("code",{class:"doc-token"},"/src-ssr/middlewares/<name>.js"),(0,t.Uk)("，内容如下：")],-1),D=(0,t._)("pre",{class:"doc-code language-js"},[(0,t._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,t._)("span",{class:"token comment"},"// 在此导入一些东西"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token comment"},'// "async "是可选的!'),(0,t.Uk)("\n"),(0,t._)("span",{class:"token comment"},"// 不需要的时候就去掉它"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"default"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"async"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" app resolveUrlPath"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" publicPath"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" folders"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" render "),(0,t._)("span",{class:"token punctuation"},"}")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token comment"},'// 与服务器 "应用程序 "有关的东西'),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])],-1),F=(0,t._)("p",null,"你也可以返回一个Promise:",-1),M=(0,t._)("pre",{class:"doc-code language-js"},[(0,t._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,t._)("span",{class:"token comment"},"// 在此输入一些东西"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"default"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" app"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" resolve"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" publicPath"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" folders"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" render"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" serve "),(0,t._)("span",{class:"token punctuation"},"}")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t._)("span",{class:"token class-name"},"Promise"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("resolve"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" reject")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token comment"},'// 与服务器 "应用程序 "有关的东西'),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])],-1),G=(0,t._)("p",null,"现在你可以根据你的SSR中间件文件的预期用途向该文件添加内容。",-1),J=(0,t._)("p",null,[(0,t.Uk)("最后一步是告诉 Quasar 使用你的新SSR中间件文件。要做到这一点，你需要在"),(0,t._)("code",{class:"doc-token"},"/quasar.conf.js"),(0,t.Uk)("中添加该文件")],-1),O=(0,t._)("pre",{class:"doc-code language-js"},[(0,t._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,t._)("span",{class:"token comment"},"// quasar.conf.js"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token literal-property property"},"ssr"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token literal-property property"},"middlewares"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"["),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token comment"},"// 参考 /src-ssr/middlewares/<name>.js"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token string"},"'<name>'"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])],-1),z=(0,t._)("p",null,"当建立一个SSR应用时，你可能希望一些启动文件只在生产或只在开发上运行，在这种情况下，你可以像下面这样做：",-1),Z=(0,t._)("pre",{class:"doc-code language-js"},[(0,t._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,t._)("span",{class:"token comment"},"// quasar.conf.js"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token literal-property property"},"ssr"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token literal-property property"},"middlewares"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"["),(0,t.Uk)("\n    ctx"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("prod "),(0,t._)("span",{class:"token operator"},"?"),(0,t.Uk)(),(0,t._)("span",{class:"token string"},"'<name>'"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token string"},"''"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token comment"},"// 我只在生产中运行！"),(0,t.Uk)("\n    ctx"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("dev "),(0,t._)("span",{class:"token operator"},"?"),(0,t.Uk)(),(0,t._)("span",{class:"token string"},"'<name>'"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token string"},"''"),(0,t.Uk)(),(0,t._)("span",{class:"token comment"},"// 我只在开发中运行"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])],-1),$=(0,t._)("p",null,[(0,t.Uk)("如果你想从node_modules中指定SSR中间件文件，你可以通过在路径前加上"),(0,t._)("code",{class:"doc-token"},"~"),(0,t.Uk)("(tilde)字符来实现：")],-1),B=(0,t._)("pre",{class:"doc-code language-js"},[(0,t._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,t._)("span",{class:"token comment"},"// quasar.conf.js"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token literal-property property"},"ssr"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token literal-property property"},"middlewares"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"["),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token comment"},"// 从一个npm包中启动文件"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token string"},"'~my-npm-package/some/file'"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])],-1),K=(0,t._)("div",{class:"doc-note doc-note--warning"},[(0,t._)("p",{class:"doc-note__title"},"WARNING"),(0,t._)("p",null,"你指定SSR中间件的顺序很重要，因为它决定了中间件应用于Nodejs服务器的方式。因此，它们会影响它对客户端的响应方式。")],-1),X=(0,t._)("div",{class:"doc-note doc-note--danger"},[(0,t._)("p",{class:"doc-note__title"},"重要!"),(0,t._)("p",null,[(0,t.Uk)("在你的应用程序中所有可能的SSR中间件中，"),(0,t._)("strong",null,"这个是绝对需要的"),(0,t.Uk)("，因为它用Vue处理实际的SSR渲染。")])],-1),Y=(0,t._)("p",null,"在下面的示例中，我们强调这个中间件需要放在列表的最后。这是因为它也会向客户端响应(正如我们在下面的第二个代码示例中看到的那样)，提供页面的HTML。因此，任何后续的中间件都不能设置头文件。",-1),nn=(0,t._)("pre",{class:"doc-code language-js"},[(0,t._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,t._)("span",{class:"token comment"},"// quasar.conf.js"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token literal-property property"},"ssr"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token literal-property property"},"middlewares"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"["),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token comment"},"// ..... 所有其他中间件"),(0,t.Uk)("\n\n    "),(0,t._)("span",{class:"token string"},"'render'"),(0,t.Uk)(),(0,t._)("span",{class:"token comment"},"// references /src-ssr/middlewares/render.js;"),(0,t.Uk)("\n             "),(0,t._)("span",{class:"token comment"},"// 你可以随心所欲地为文件命名。"),(0,t.Uk)("\n             "),(0,t._)("span",{class:"token comment"},"// 只要确保它作为最后一个中间件运行就可以了"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])],-1),sn=(0,t._)("p",null,"现在让我们看看它包含什么：",-1),an=(0,t._)("pre",{class:"doc-code language-js"},[(0,t._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,t._)("span",{class:"token comment"},"// src-ssr/middlewares/render.js"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token comment"},"// 这个中间件应该作为最后一个执行"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token comment"},"// 因为它捕捉到了一切，并试图"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token comment"},"// 用Vue渲染页面"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"default"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" app"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" resolve"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" render"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" serve "),(0,t._)("span",{class:"token punctuation"},"}")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token comment"},"// 我们捕获任何其他快递路线并将其交给"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token comment"},"// 转到Vue和Vue Router来渲染我们的页面"),(0,t.Uk)("\n  app"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"get"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("resolve"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"urlPath"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'*'"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("req"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" res")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    res"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"setHeader"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'Content-Type'"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token string"},"'text/html'"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\n    "),(0,t._)("span",{class:"token function"},"render"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" req"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" res "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"then"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},"html"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token comment"},"// 现在让我们把渲染好的html发送到客户端"),(0,t.Uk)("\n        res"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"send"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("html"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"catch"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},"err"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token comment"},"// 哎呀，我们在渲染页面时出现了一个错误"),(0,t.Uk)("\n\n        "),(0,t._)("span",{class:"token comment"},"// 我们被告知要重定向到另一个URL"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("err"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("url"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n          "),(0,t._)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("err"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("code"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n            res"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"redirect"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("err"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("code"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" err"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("url"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n          "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n          "),(0,t._)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n            res"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"redirect"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("err"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("url"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n          "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token comment"},"// 嗯，Vue Router找不到请求的路由"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("err"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("code "),(0,t._)("span",{class:"token operator"},"==="),(0,t.Uk)(),(0,t._)("span",{class:"token number"},"404"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n          "),(0,t._)("span",{class:"token comment"},'// 只有在没有 "总括 "路线的情况下，才应到达这里。'),(0,t.Uk)("\n          "),(0,t._)("span",{class:"token comment"},"// 是在/src/routes中定义的。"),(0,t.Uk)("\n          res"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"status"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token number"},"404"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"send"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'404 | Page Not Found'"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token comment"},"// 那么，我们把任何其他代码都视为错误。"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token comment"},"// 如果我们是在开发模式下，那么我们可以使用Quasar CLI"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token comment"},"// 以显示一个漂亮的错误页面，其中包含堆栈"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token comment"},"// 和其他有用的信息"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("process"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("env"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token constant"},"DEV"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n          "),(0,t._)("span",{class:"token comment"},"// service.error仅在dev上可用"),(0,t.Uk)("\n          serve"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"error"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" err"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" req"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" res "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token comment"},"// 我们在生产中，所以我们应该有另一种方法"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token comment"},"// 当我们遇到错误时，向客户端显示一些东西"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token comment"},"// (出于安全原因，显示相同的财富是不可以的。"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token comment"},"// 的信息，正如我们在开发中所做的那样)"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n          "),(0,t._)("span",{class:"token comment"},"// 在生产过程中呈现错误页面或"),(0,t.Uk)("\n          "),(0,t._)("span",{class:"token comment"},"// 为错误页面创建一个路由(/src/routes)并重定向到它"),(0,t.Uk)("\n          res"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"status"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token number"},"500"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"send"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'500 | Internal Server Error'"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])],-1),tn=(0,t._)("p",null,[(0,t.Uk)("注意中间件的导出函数被调用的"),(0,t._)("code",{class:"doc-token"},"render"),(0,t.Uk)("参数(来自上面的代码样本)。这就是发生SSR渲染的地方。")],-1),on=(0,t._)("p",null,"在开发过程中，每当你改变SSR中间件中的任何内容，Quasar App CLI将自动触发客户端资源的重新编译，并将中间件的变化应用到Nodejs服务器(Expressjs)。",-1),en=(0,t._)("div",{class:"doc-note doc-note--tip"},[(0,t._)("p",{class:"doc-note__title"},"TIP"),(0,t._)("p",null,"你可以使用任何兼容Expressjs的中间件。")],-1),cn=(0,t._)("p",null,"这个有意义，只用于生产。",-1),pn=(0,t._)("pre",{class:"doc-code language-js"},[(0,t._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,t._)("span",{class:"token keyword"},"import"),(0,t.Uk)(" compression "),(0,t._)("span",{class:"token keyword"},"from"),(0,t.Uk)(),(0,t._)("span",{class:"token string"},"'compression'"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"default"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" app "),(0,t._)("span",{class:"token punctuation"},"}")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  app"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"use"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token function"},"compression"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(),(0,t._)("span",{class:"token literal-property property"},"threshold"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token number"},"0"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])],-1),ln=(0,t._)("p",null,"应用SSR中间件的顺序很重要。因此，明智的做法是将下面这个设置为第一个(在quasar.conf.js > ssr > middlewares中)，这样它就能够拦截所有的客户端请求。",-1),kn=(0,t._)("pre",{class:"doc-code language-js"},[(0,t._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,t._)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"default"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" app"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" resolve "),(0,t._)("span",{class:"token punctuation"},"}")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  app"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"all"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("resolve"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"urlPath"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'*'"),(0,t._)("span",{class:"token punctuation"},")"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},[(0,t.Uk)("req"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" _"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" next")]),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    console"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"log"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'someone requested:'"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" req"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("url"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token function"},"next"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])],-1);function un(n,s,a,un,_n,rn){const dn=(0,t.up)("doc-link"),Un=(0,t.up)("q-markup-table"),mn=(0,t.up)("doc-page");return(0,t.wg)(),(0,t.j4)(mn,{"meta-title":un.metaTitle,title:"SSR中间件",related:un.related,nav:un.nav,toc:un.toc,"meta-desc":un.metaDesc},{default:(0,t.w5)((()=>[o,e,(0,t._)("div",c,[p,(0,t._)("p",null,[l,(0,t.Wm)(dn,{to:"https://expressjs.com/en/4x/api.html"},{default:(0,t.w5)((()=>[k])),_:1}),u])]),_,(0,t._)("h2",{id:"中间件文件的剖析",class:"doc-heading doc-h2",onClick:s[0]||(s[0]=n=>un.copyHeading("中间件文件的剖析"))},"中间件文件的剖析"),r,i,d,U,m,g,(0,t._)("p",null,[h,(0,t.Wm)(dn,{to:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment"},{default:(0,t.w5)((()=>[y])),_:1}),f]),(0,t._)("h2",{id:"中间件对象参数",class:"doc-heading doc-h2",onClick:s[1]||(s[1]=n=>un.copyHeading("中间件对象参数"))},"中间件对象参数"),w,S,j,v,(0,t._)("h4",{id:"应用程序",class:"doc-heading doc-h4",onClick:s[2]||(s[2]=n=>un.copyHeading("应用程序"))},"应用程序"),b,(0,t._)("h4",{id:"解析",class:"doc-heading doc-h4",onClick:s[3]||(s[3]=n=>un.copyHeading("解析"))},"解析"),(0,t.Wm)(Un,{"wrap-cells":!0,flat:!0,bordered:!0,style:{width:"fit-content","max-width":"100%"}},{default:(0,t.w5)((()=>[R,x])),_:1}),(0,t._)("h4",{id:"publicpath",class:"doc-heading doc-h4",onClick:s[4]||(s[4]=n=>un.copyHeading("publicpath"))},"publicPath"),q,(0,t._)("h4",{id:"folders",class:"doc-heading doc-h4",onClick:s[5]||(s[5]=n=>un.copyHeading("folders"))},"folders"),P,(0,t.Wm)(Un,{"wrap-cells":!0,flat:!0,bordered:!0,style:{width:"fit-content","max-width":"100%"}},{default:(0,t.w5)((()=>[C,H])),_:1}),(0,t._)("h4",{id:"渲染",class:"doc-heading doc-h4",onClick:s[6]||(s[6]=n=>un.copyHeading("渲染"))},"渲染"),E,(0,t._)("h4",{id:"service",class:"doc-heading doc-h4",onClick:s[7]||(s[7]=n=>un.copyHeading("service"))},"service"),I,N,T,L,(0,t._)("h2",{id:"ssr中间件的使用",class:"doc-heading doc-h2",onClick:s[8]||(s[8]=n=>un.copyHeading("ssr中间件的使用"))},"SSR中间件的使用"),V,A,Q,W,D,F,M,G,J,O,z,Z,$,B,K,(0,t._)("h2",{id:"###ssr的渲染中间件",class:"doc-heading doc-h2",onClick:s[9]||(s[9]=n=>un.copyHeading("###ssr的渲染中间件"))},"###SSR的渲染中间件"),X,Y,nn,sn,an,tn,(0,t._)("h2",{id:"热模块重新加载",class:"doc-heading doc-h2",onClick:s[10]||(s[10]=n=>un.copyHeading("热模块重新加载"))},"热模块重新加载"),on,(0,t._)("h2",{id:"ssr中间件的示例",class:"doc-heading doc-h2",onClick:s[11]||(s[11]=n=>un.copyHeading("ssr中间件的示例"))},"SSR中间件的示例"),en,(0,t._)("h3",{id:"压缩",class:"doc-heading doc-h3",onClick:s[12]||(s[12]=n=>un.copyHeading("压缩"))},"压缩"),cn,pn,(0,t._)("h3",{id:"记录器-拦截器",class:"doc-heading doc-h3",onClick:s[13]||(s[13]=n=>un.copyHeading("记录器-拦截器"))},"记录器/拦截器"),ln,kn])),_:1},8,["meta-title","related","nav","toc","meta-desc"])}var _n=a(17536);const rn={name:"DocMarkdownPage",setup(){return{metaTitle:"SSR中间件",metaDesc:"在 Quasar 应用程序中管理SSR中间件。",related:[{name:"quasar.conf.js",category:"Quasar CLI",path:"/quasar-cli/quasar-conf-js"}],nav:[{name:"ssrContext",category:"开发 SSR",path:"/quasar-cli/developing-ssr/ssr-context",dir:"left"},{name:"SSR 生产导出",category:"开发 SSR",path:"/quasar-cli/developing-ssr/ssr-production-export",dir:"right"}],toc:[{id:"中间件文件的剖析",title:"中间件文件的剖析"},{id:"中间件对象参数",title:"中间件对象参数"},{id:"ssr中间件的使用",title:"SSR中间件的使用"},{id:"###ssr的渲染中间件",title:"###SSR的渲染中间件"},{id:"热模块重新加载",title:"热模块重新加载"},{id:"ssr中间件的示例",title:"SSR中间件的示例"},{id:"压缩",title:"压缩",sub:!0},{id:"记录器-拦截器",title:"记录器/拦截器",sub:!0}],copyHeading:_n.Et}}};var dn=a(74260);const Un=(0,dn.Z)(rn,[["render",un]]),mn=Un}}]);