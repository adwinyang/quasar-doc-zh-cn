"use strict";(globalThis["webpackChunkquasar_dev"]=globalThis["webpackChunkquasar_dev"]||[]).push([[66196],{66196:(n,s,a)=>{a.r(s),a.d(s,{default:()=>q});var t=a(83673);const o=(0,t._)("p",null,[(0,t.Uk)("在这里，你将学习如何在你的网站/应用程序空间内与服务工作者互动。记住，"),(0,t._)("strong",null,"服务工作者必须通过HTTPS提供服务"),(0,t.Uk)("。")],-1),e=(0,t._)("p",null,[(0,t.Uk)("值得注意的是，服务工作器(由Workbox自动生成–或者你已经将 Quasar CLI 配置为使用你的自定义服务工作器)在一个单独的线程中运行。然而，你可以从应用空间中的"),(0,t._)("code",{class:"doc-token"},"/src-pwa/register-service-worker.js"),(0,t.Uk)("文件中与它进行交互。")],-1),c=(0,t.Uk)("注意"),p=(0,t.Uk)("register-service-worker"),k=(0,t.Uk)(" npm包，它与 Quasar CLI 一起开箱即用(所以不要自己安装)。"),l=(0,t._)("pre",{class:"doc-code language-js"},[(0,t._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,t._)("span",{class:"token comment"},"// src-pwa/register-service-worker.js文件"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token keyword"},"import"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" register "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t._)("span",{class:"token keyword"},"from"),(0,t.Uk)(),(0,t._)("span",{class:"token string"},"'register-service-worker'"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token function"},"register"),(0,t._)("span",{class:"token punctuation"},"("),(0,t.Uk)("process"),(0,t._)("span",{class:"token punctuation"},"."),(0,t.Uk)("env"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token constant"},"SERVICE_WORKER_FILE"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token function"},"ready"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},"registration"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    console"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"log"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'Service worker is active.'"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token function"},"registered"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},"registration"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    console"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"log"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'Service worker has been registered.'"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token function"},"cached"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},"registration"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    console"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"log"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'Content has been cached for offline use.'"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token function"},"updatefound"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},"registration"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    console"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"log"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'New content is downloading.'"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token function"},"updated"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},"registration"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    console"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"log"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'New content is available; please refresh.'"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token function"},"offline"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    console"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"log"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'No internet connection found. App is running in offline mode.'"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n\n  "),(0,t._)("span",{class:"token function"},"error"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token parameter"},"error"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    console"),(0,t._)("span",{class:"token punctuation"},"."),(0,t._)("span",{class:"token function"},"error"),(0,t._)("span",{class:"token punctuation"},"("),(0,t._)("span",{class:"token string"},"'Error during service worker registration:'"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(" error"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n")])],-1),r=(0,t._)("div",{class:"doc-note doc-note--tip"},[(0,t._)("p",{class:"doc-note__title"},"TIP"),(0,t._)("p",null,[(0,t.Uk)("这个文件会被 Quasar CLI 自动捆绑到你的网站/应用程序中，因为它被认为是应用程序空间"),(0,t._)("code",{class:"doc-token"},"/src"),(0,t.Uk)("的一部分。这意味着你可以使用ES6，导入其他文件等。")])],-1),u=(0,t._)("p",null,[(0,t.Uk)("你可能会注意到，在一些开发环境中，如果你没有使用HTTPS来提供服务，Workbox在"),(0,t._)("code",{class:"doc-token"},"quasar dev"),(0,t.Uk)("期间不会加载你的服务工作者，即使是在localhost上。你会看到有两个脚本无法加载。Chrome浏览器的控制台对这个问题相对保密，但Firefox告诉你发生了什么。你有三个选择：。")],-1),i=(0,t._)("ul",null,[(0,t._)("li",null,[(0,t.Uk)("设置 quasar.conf.js > devServer > "),(0,t._)("code",{class:"doc-token"},"https: true"),(0,t.Uk)("。")]),(0,t._)("li",null,"设置一个从localhost到127.0.0.1的环路(但这并不是没有安全问题)。"),(0,t._)("li",null,"通过ngrok为你的localhost服务，并使用ngrok提供的https地址。")],-1),_=(0,t.Uk)("当你在quasar.conf.js文件中设置"),d=(0,t._)("code",{class:"doc-token"},"devServer > https: true",-1),U=(0,t.Uk)("时，Quasar将为你自动生成一个SSL证书。然而，如果你想自己为你的本地主机创建一个，那么请查看"),g=(0,t.Uk)("Filippo"),h=(0,t.Uk)("的这篇博文。然后你的"),v=(0,t._)("code",{class:"doc-token"},"quasar.conf.js > devServer > https",-1),f=(0,t.Uk)("应该是这样的："),y=(0,t._)("pre",{class:"doc-code language-js"},[(0,t._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-js"},[(0,t._)("span",{class:"token comment"},"// quasar.conf.js"),(0,t.Uk)("\n\n"),(0,t._)("span",{class:"token literal-property property"},"devServer"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token literal-property property"},"server"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token literal-property property"},"type"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token string"},"'https'"),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token comment"},"// NECESSARY"),(0,t.Uk)("\n\n    "),(0,t._)("span",{class:"token literal-property property"},"options"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token comment"},"// 使用ABSOLUTE路径或path.join(__dirname, 'root/relative/path')。"),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token literal-property property"},"key"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token string"},'"/path/to/server.key"'),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token literal-property property"},"pfx"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token string"},'"/path/to/server.pfx"'),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token literal-property property"},"cert"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token string"},'"/path/to/server.crt"'),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token literal-property property"},"ca"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token string"},'"/path/to/ca.pem"'),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token literal-property property"},"passphrase"),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token string"},"'webpack-dev-server'"),(0,t.Uk)(),(0,t._)("span",{class:"token comment"},"// do you need it?"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])],-1),m=(0,t._)("p",null,[(0,t.Uk)("重要的是，你不允许浏览器缓存"),(0,t._)("code",{class:"doc-token"},"service-worker.js"),(0,t.Uk)("文件。因为否则的话，这个文件或你的应用程序的更新可能会让那些从缓存中加载service-worker的浏览器漏掉。")],-1),w=(0,t._)("p",null,[(0,t.Uk)("这就是为什么你必须始终确保添加"),(0,t._)("code",{class:"doc-token"},'"Cache-Control": "no-cache"'),(0,t.Uk)("到"),(0,t._)("code",{class:"doc-token"},"service-worker.js"),(0,t.Uk)("文件的标题中，通过你的主机服务。")],-1),S=(0,t._)("p",null,[(0,t.Uk)("以Google Firebase为例，你可以在"),(0,t._)("code",{class:"doc-token"},"firebase.json"),(0,t.Uk)("配置中添加以下内容：")],-1),j=(0,t._)("pre",{class:"doc-code language-json"},[(0,t._)("code",{class:"doc-code__inner doc-code__inner--prerendered language-json"},[(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token property"},'"hosting"'),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token property"},'"headers"'),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"["),(0,t.Uk)("\n      "),(0,t._)("span",{class:"token punctuation"},"{"),(0,t.Uk)(),(0,t._)("span",{class:"token property"},'"source"'),(0,t._)("span",{class:"token operator"},":"),(0,t._)("span",{class:"token string"},'"/service-worker.js"'),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token property"},'"headers"'),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"["),(0,t._)("span",{class:"token punctuation"},"{"),(0,t._)("span",{class:"token property"},'"key"'),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token string"},'"Cache-Control"'),(0,t._)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t._)("span",{class:"token property"},'"value"'),(0,t._)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t._)("span",{class:"token string"},'"no-cache"'),(0,t._)("span",{class:"token punctuation"},"}"),(0,t._)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t._)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n  "),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t._)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])],-1);function C(n,s,a,C,b,T){const E=(0,t.up)("doc-link"),W=(0,t.up)("doc-page");return(0,t.wg)(),(0,t.j4)(W,{"meta-title":C.metaTitle,title:"处理服务工作者",nav:C.nav,toc:C.toc,"meta-desc":C.metaDesc},{default:(0,t.w5)((()=>[o,e,(0,t._)("h2",{id:"与服务工作者互动",class:"doc-heading doc-h2",onClick:s[0]||(s[0]=n=>C.copyHeading("与服务工作者互动"))},"与服务工作者互动"),(0,t._)("p",null,[c,(0,t.Wm)(E,{to:"https://github.com/yyx990803/register-service-worker"},{default:(0,t.w5)((()=>[p])),_:1}),k]),l,r,(0,t._)("h2",{id:"ssl证书",class:"doc-heading doc-h2",onClick:s[1]||(s[1]=n=>C.copyHeading("ssl证书"))},"SSL证书"),u,i,(0,t._)("p",null,[_,d,U,(0,t.Wm)(E,{to:"https://blog.filippo.io/mkcert-valid-https-certificates-for-localhost/"},{default:(0,t.w5)((()=>[g])),_:1}),h,v,f]),y,(0,t._)("h2",{id:"重要的主机配置",class:"doc-heading doc-h2",onClick:s[2]||(s[2]=n=>C.copyHeading("重要的主机配置"))},"重要的主机配置"),m,w,S,j])),_:1},8,["meta-title","nav","toc","meta-desc"])}var b=a(17536);const T={name:"DocMarkdownPage",setup(){return{metaTitle:"处理服务工作者",metaDesc:"如何在Quasar Progressive Web App中配置服务工作者。",nav:[{name:"PWA的应用程序图标",category:"开发PWA",path:"/quasar-cli/developing-pwa/app-icons-pwa",dir:"left"},{name:"使用Typescript的PWA",category:"开发PWA",path:"/quasar-cli/developing-pwa/pwa-with-typescript",dir:"right"}],toc:[{id:"与服务工作者互动",title:"与服务工作者互动"},{id:"ssl证书",title:"SSL证书"},{id:"重要的主机配置",title:"重要的主机配置"}],copyHeading:b.Et}}};var E=a(74260);const W=(0,E.Z)(T,[["render",C]]),q=W}}]);